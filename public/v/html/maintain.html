<!DOCTYPE html>
<!-- 主体布局架构 -->
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>

    <!-- css文件 -->
    <link href="../css/root.css" rel="stylesheet">

    <style>
        body {
            background-color: #edf0f5;
        }

        input[type=checkbox] {
            zoom: 100%;
        }
    </style>

    <!-- js文件 -->
    <script src="../js/jquery.min.js"></script>

</head>
<body>
    <!-- 页面加载 -->
    <div class="loading"><img src="../img/loading.gif" alt="加载中"></div>

    <!-- 顶层 -->
    <div id="top" class="clearfix">

        <div class="applogo">
            <a class="logo">菜单</a>
        </div>

        <!-- 隐藏显示菜单图标 -->
        <a href="#" class="sidebar-open-button"><i class="fa fa-bars"></i></a>
        <a href="#" class="sidebar-open-button-mobile"><i class="fa fa-bars"></i></a>

        <!-- 页面标题 -->
        <h1 class="title">自助售药机后台管理系统</h1>

    </div>

    <!-- 左侧栏 -->
    <div class="sidebar clearfix">

        <!-- 用户信息 -->
        <div class="dropdown link">
            <a href="#" data-toggle="dropdown" class="dropdown-toggle profilebox">
                <img src="../img/profileimg.png" alt="img">
                <div class="user-name"><b id="userInfo"></b><span class="caret"></span></div>
            </a>
            <script>
                // 设置当前用户信息
                $("#userInfo").text(user.realname + "(" + user.username + ")");
            </script>
            <ul class="dropdown-menu dropdown-menu-list dropdown-menu-right">
                <li role="presentation" class="dropdown-header">选项</li>
                <li><a href="login.html"><i class="fa falist fa-power-off"></i> 退出</a></li>
            </ul>
        </div>

        <!-- 菜单 -->
        <ul class="sidebar-panel nav">
            <li class="sidetitle">机器管理</li>
            <li><a href="runStatus.html"><span class="icon color5"><i class="fa fa-home"></i></span>运行状态</a></li>
            <li>
                <a href="#"><span class="icon color7"><i class="fa fa-laptop"></i></span>药机管理<span class="caret"></span></a>
                <ul>
                    <li><a href="machineGroup.html">机器分组</a></li>
                    <li><a href="motorInfo.html">货道设置</a></li>
                    <li><a href="machineInfo.html">机器信息设置</a></li>
                    <li><a href="maintain.html">机器维护</a></li>
                </ul>
            </li>
            <li><a href="wsdChart.html"><span class="icon color6"><i class="fa fa-bar-chart"></i></span>温湿度详情</a></li>
            <li><a href="warningStatus.html"><span class="icon color6"><i class="fa fa-bar-chart"></i></span>警报详情</a></li>
        </ul>
        <ul class="sidebar-panel nav">
            <li class="sidetitle">药品管理</li>
            <li><a href="categoryInfo.html"><span class="icon color5"><i class="fa fa-folder"></i></span>分类管理</a></li>
            <li><a href="drugInfo.html"><span class="icon color6"><i class="fa fa-calendar"></i></span>药品列表</a></li>
            <li style="display:none"><a href="#"><span class="icon color7"><i class="fa fa-sort-amount-asc"></i></span>期效管理<span class="caret"></span></a></li>
            <li><a href="lotNumber.html"><span class="icon color6"><i class="fa fa-file-word-o"></i></span>批号管理</a></li>
            <li><a href="situation.html"><span class="icon color5"><i class="fa fa-folder"></i></span>病情管理</a></li>

        </ul>
        <ul class="sidebar-panel nav">
            <li class="sidetitle">记录管理</li>
            <li><a href="saleRecord.html"><span class="icon color5"><i class="fa fa-calendar-o"></i></span>销售记录</a></li>
            <li style="display:none"> <a href=""><span class="icon color6"><i class="fa fa-calendar"></i></span>操作记录</a>
            <li>
                <a href="#"><span class="icon color7"><i class="fa fa-calendar-o"></i></span>药品记录<span class="caret"></span></a>
                <ul>
                    <li><a href="addDrugInfo.html">上药记录</a></li>
                    <li><a href="subDrugInfo.html">撤药记录</a></li>
                </ul>
            </li>
            <li><a href="" style="display:none"><span class="icon color6"><i class="fa fa-calendar"></i></span>报警记录</a></li>
        </ul>
        <ul class="sidebar-panel nav">
            <li class="sidetitle">用户管理</li>
            <li><a href="userInfo.html"><span class="icon color5"><i class="fa fa-user"></i></span>用户信息</a></li>
        </ul>
        <ul class="sidebar-panel nav" style="display:none">
            <li class="sidetitle">财务管理</li>
            <li><a href="blank1.html"><span class="icon color5"><i class="fa fa-calendar-o"></i></span>销售统计</a></li>
        </ul>
        <ul class="sidebar-panel nav">
            <li class="sidetitle">其他设置</li>
            <li><a href="sysSetting.html"><span class="icon color12"><i class="fa fa-cog"></i></span>系统设置</a></li>
        </ul>
    </div>

    <!-- 主内容 -->
    <div class="content">

        <!-- 当前页面的菜单位置 -->
        <div class="page-header">
            <ol class="breadcrumb" id="breadcrumb">
                <li>机器管理</li>
                <li>机器维护</li>
            </ol>
        </div>

        <!-- 内容 -->
        <div class="container-padding container-widget" id="content">


            <!-- 搜索条件 -->
            <div class="row">

                <div class="col-md-12 col-lg-12">

                    <div class="panel panel-default">
                        <div class="panel-title" style="font-size:15px">搜索条件</div>
                        <div class="panel-body">
                            <div class="form-inline">
                                <div class="form-group">
                                    <label for="machine_name" class="control-label form-label">机器名称：</label>
                                    <select class="selectpicker" data-live-search="true" id="machine_name"></select>
                                </div>

                                <div class="form-group">
                                    <label for="startTime" class="form-label control-label">起始日期：</label>
                                    <i class="fa fa-calendar"></i>
                                    <input id="startTime" class="form-control" type="date">
                                </div>
                                <div class="form-group">
                                    <label for="endTime" class="form-label control-label">终止日期：</label>
                                    <i class="fa fa-calendar"></i>
                                    <input id="endTime" class="form-control" type="date">
                                </div>
                                <div class="form-group">
                                    <a id="search" class="btn btn-rounded btn-default" onclick="mySearch()">查  询</a>
                                </div>
                                <div class="form-group">
                                    <a id="add" class="btn btn-rounded btn-success" data-toggle="modal" data-target="#alterGroupModal" onclick="addInfoInit()">新  增</a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>



            <div class="row">

                <div class="col-md-12 col-lg-12">

                    <div class="panel panel-default">

                        <div class="panel-body">


                            <div role="tabpanel">

                                <!-- tab标题 -->
                                <ul class="nav nav-tabs" role="tablist" id="tabTitle">
                                    <!--<li role="presentation" class="active" onclick="alert('sdf');"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">药品信息</a></li>
                                    <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">药品图片</a></li>
                                    <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">说明图片</a></li>-->
                                </ul>
                                <!-- Tab 内容 -->
                                <div class="tab-content" id="tabContent" style="display:none">
                                    <div role="tabpanel" class="tab-pane active" id="home" style="font-size:18px;">

                                        <label class="form-label" id="mName">机器名称：</label>
                                        <br />
                                        <br />
                                        <label for="alattr" class="form-label">维护选项：</label>
                                        <br />
                                        <label class="form-label">
                                            <input id="drugIs" disabled type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;查看药品是否正常，有无破损
                                        </label>
                                        <br />
                                        <label class="form-label">
                                            <input id="deadlineIs" disabled type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;登录后台查看药品是否过期
                                        </label>
                                        <br />
                                        <label class="form-label">
                                            <input id="motorIs" disabled type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;登录后台查看售药机货道是否正常
                                        </label>
                                        <br />
                                        <label class="form-label">
                                            <input id="wsdIs" disabled type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;登录后台查看售药机机柜温湿度是否正常
                                        </label>
                                        <br />
                                        <label class="form-label">
                                            <input id="machineIs" disabled type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;查看机器是否正常，打印机口和通风口是否被异物堵住，购买操作是否正常
                                        </label>
                                        <br />
                                        <label class="form-label">
                                            <input id="featuresIs" disabled type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;药机操作是否正常
                                        </label>
                                        <br />
                                        <br />
                                        <label class="form-label" id="timer">保存时间：</label>
                                        <br />
                                        <br />
                                        <label class="form-label" id="opUser">操作人员：</label>
                                    </div>
                                </div>
                            </div>



                        </div>

                    </div>

                </div>

            </div>



        </div>

    </div>

    <!-- 添加对话框 -->
    <div class="modal fade" id="alterGroupModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">添加维护记录</h4>
                </div>
                <div class="modal-body">
                    <div class="horizontal">
                        <div class="form-group">
                            <label for="dName" class="form-label">机器名称：</label>
                            <select class="selectpicker form-control" data-live-search="true" id="amName"></select>
                        </div>
                        <div class="form-group">
                            <label for="alattr" class="form-label">维护选项：</label>
                            <br />
                            <label class="form-label">
                                <input id="adrugIs" type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;查看药品是否正常，有无破损
                            </label>
                            <br>
                            <label class="form-label">
                                <input id="adeadlineIs" type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;登录后台查看药品是否过期
                            </label>
                            <br />
                            <label class="form-label">
                                <input id="amotorIs" type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;登录后台查看售药机货道是否正常
                            </label>
                            <br />
                            <label class="form-label">
                                <input id="awsdIs" type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;登录后台查看售药机机柜温湿度是否正常
                            </label>
                            <br />
                            <label class="form-label">
                                <input id="amachineIs" type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;查看机器是否正常，打印机口和通风口是否被异物堵住，购买操作是否正常
                            </label>
                            <br />
                            <label class="form-label">
                                <input id="afeaturesIs" type="checkbox" style="border-radius: 50%; height:25px; width:25px;vertical-align:-6px;">&nbsp;&nbsp;&nbsp;&nbsp;药机操作是否正常
                            </label>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal" id="addClose" onclick="">关闭</button>
                    <button type="button" class="btn btn-default" onclick="addInfo()">保存</button>
                </div>

            </div>
        </div>
    </div>



    <!-- 底部信息 -->
    <div class="row footer" style="display:none">
        <div class="col-md-6 text-left">
            Copyright &copy; 2018.Company name All rights reserved.<a href="#">沈阳华天基曼龙有限公司</a>
        </div>
        <div class="col-md-6 text-right"></div>
    </div>

    <!-- 错误提示 -->
    <div id="alerttop" class="Modern-alert Modern-alert-icon Modern-alert-click alert6 Modern-alert-top"></div>
    <!-- 成功提示 -->
    <div id="successtop" class="Modern-alert Modern-alert-icon Modern-alert-click alert3 Modern-alert-top"></div>


    <script src="../js/bootstrap/bootstrap.min.js"></script>
    <script src="../js/plugins.js"></script>
    <script src="../js/datatables/datatables.min.js"></script> <!-- Data Tables -->
    <script src="../js/bootstrap-select/bootstrap-select.js"></script> <!-- Bootstrap Select -->
    <script src="../js/bootstrap-toggle/bootstrap-toggle.min.js"></script> <!-- Bootstrap Toggle -->
    <script src="../js/moment/moment.min.js"></script> <!-- Moment.js -->
    <script src="../js/date-range-picker/daterangepicker.js"></script> <!-- Bootstrap Date Range Picker -->
    <script src="../js/sweet-alert/sweet-alert.min.js"></script> <!-- Sweet Alert -->
    <script src="../js/Modern-alert/main.js"></script><!-- Modern Alert -->

    <script>
        // 添加养护信息
        function addInfo() {
            if ($("#amName").val() == '0') {
                $("#alerttop").text('请选择机器');
                $("#successtop").fadeOut(1);
                $("#alerttop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#alerttop").fadeOut(350); }, 2000);
                return;
            }
            if (!$("#adrugIs").prop("checked") && !$("#adeadlineIs").prop("checked") && !$("#amotorIs").prop("checked") && !$("#awsdIs").prop("checked") && !$("#amachineIs").prop("checked") && !$("#afeaturesIs").prop("checked")) {
                $("#alerttop").text('请选择养护项');
                $("#successtop").fadeOut(1);
                $("#alerttop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#alerttop").fadeOut(350); }, 2000);
                return;
            }
            var drugis = $("#adrugIs").prop("checked") ? '1' : '0';
            var deadlineis = $("#adeadlineIs").prop("checked") ? '1' : '0';
            var motoris = $("#amotorIs").prop("checked") ? '1' : '0';
            var wsdis = $("#awsdIs").prop("checked") ? '1' : '0';
            var machineis = $("#amachineIs").prop("checked") ? '1' : '0';
            var featuresis = $("#afeaturesIs").prop("checked") ? '1' : '0';

            if (commonBind.AddMaintain($("#amName").val() + "", drugis, deadlineis, motoris, machineis, featuresis, wsdis)) {
                $("#successtop").text('添加养护记录成功');
                $("#alerttop").fadeOut(1);
                $("#successtop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                $("#addClose").click();
                timeout = setTimeout(function () { $("#successtop").fadeOut(350); }, 2000);
            } else {
                $("#alerttop").text('添加养护记录成功');
                $("#successtop").fadeOut(1);
                $("#alerttop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#alerttop").fadeOut(350); }, 2000);
            }
        }



        // 添加维护记录时，还原多选框
        function addInfoInit() {
            $('#adrugIs').attr("checked", false);
            $('#adeadlineIs').attr("checked", false);
            $('#amotorIs').attr("checked", false);
            $('#awsdIs').attr("checked", false);
            $('#amachineIs').attr("checked", false);
            $('#afeaturesIs').attr("checked", false);
            $("#amName").selectpicker("val", 0);
            $("#amName").change();
        }


        // 添加机器名称下拉列表和机器ID下拉列表
        function machineIdNameSelecter(machineGourpId) {
            $("#machine_name").empty();
            $("#machine_id").empty();
            var m_selecter_obj = JSON.parse(commonBind.MachineSelecterJson(machineGourpId));
            var machineName = "<option value='0'>全部</option>"
            for (var mindex = 0; mindex < m_selecter_obj.length; mindex++) {
                machineName += "<option value='" + m_selecter_obj[mindex].id + "'>" + m_selecter_obj[mindex].machine_name + "</option>";
            }
            $("#machine_name").append(machineName);
            $('#machine_name').selectpicker('refresh');
            $('#machine_name').selectpicker('render');
            $("#amName").append(machineName);
            $('#amName').selectpicker('refresh');
            $('#amName').selectpicker('render');

        }
        machineIdNameSelecter('0');

        var timeout = null;
        // 查询
        function mySearch() {
            if ($("#machine_name").val() == '0') {
                $("#alerttop").text('请选择机器');
                $("#successtop").fadeOut(1);
                $("#alerttop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#alerttop").fadeOut(350); }, 2000);
                return;
            }
            if ($("#startTime").val() == '' || $("#endTime").val() == '') {
                $("#alerttop").text('请选择日期');
                $("#successtop").fadeOut(1);
                $("#alerttop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#alerttop").fadeOut(350); }, 2000);
                return;
            }

            var maintainInfoObj = JSON.parse(commonBind.MaintainInfo($("#machine_name").val(), $("#startTime").val(), $("#endTime").val()));

            $('#tabTitle').empty();
            $('#tabContent').attr('style', 'display:none');

            var tabTitle = "";
            for (var i = 0; i < maintainInfoObj.length; i++) {
                tabTitle += "<li onclick=tabClick(this) data-mName='" + maintainInfoObj[i].machine_name + "' data-timer='" + maintainInfoObj[i].timer + "' data-machine='" + maintainInfoObj[i].machine_is_normal + "' data-name='" + maintainInfoObj[i].name + "' data-drug='" + maintainInfoObj[i].drug_is_normal + "' data-deadline='" + maintainInfoObj[i].deadline_is_normal + "' data-motor='" + maintainInfoObj[i].motor_is_normal + "' data-features='" + maintainInfoObj[i].features_is_normal + "' data-wsd='" + maintainInfoObj[i].wsd_is_normal + "' " + (i == 0 ? "class=\"active\"" : "") + "  role=\"presentation\"><a href=\"#home\" aria-controls=\"home\" role=\"tab\" data-toggle=\"tab\">" + maintainInfoObj[i].timer + "</a></li>";
            }
            $('#tabTitle').append(tabTitle);
            if (maintainInfoObj.length > 0) {
                var first = $("#tabTitle li:first-child");
                first.click();
                $('#tabContent').attr('style', '');
            }

        }


        function tabClick(obj) {
            $('#mName').text("机器名称：" + $(obj).attr('data-mName'));


            if ($(obj).attr('data-features') == '1') {
                $('#featuresIs').attr("checked", true);
            } else {
                $('#featuresIs').attr("checked", false);
            }

            if ($(obj).attr('data-machine') == '1') {
                $('#machineIs').attr("checked", true);
            } else {
                $('#machineIs').attr("checked", false);

            }

            if ($(obj).attr('data-wsd') == '1') {
                $('#wsdIs').attr("checked", true);
            } else {
                $('#wsdIs').attr("checked", false);
            }

            if ($(obj).attr('data-motor') == '1') {
                $('#motorIs').attr("checked", true);
            } else {
                $('#motorIs').attr("checked", false);
            }

            if ($(obj).attr('data-drug') == '1') {
                $('#drugIs').attr("checked", true);
            } else {
                $('#drugIs').attr("checked", false);
            }

            if ($(obj).attr('data-deadline') == '1') {
                $('#deadlineIs').attr("checked", true);
            } else {
                $('#deadlineIs').attr("checked", false);
            }


            $('#timer').text('保存时间：' + $(obj).attr('data-timer'));
            $('#opUser').text('操作人员：' + $(obj).attr('data-name'));

        }

    </script>

</body>
</html>