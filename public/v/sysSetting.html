<!DOCTYPE html>
<!-- 主体布局架构 -->
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>

    <!-- css文件 -->
    <link href="../css/root.css" rel="stylesheet">

    <style>
        body {
            background-color: #edf0f5;
        }
    </style>

    <!-- js文件 -->
    <script src="../js/jquery.min.js"></script>

</head>
<body>
    <!-- 页面加载 -->
    <div class="loading"><img src="../img/loading.gif" alt="加载中"></div>

    <!-- 顶层 -->
    <div id="top" class="clearfix">

        <div class="applogo">
            <a class="logo">菜单</a>
        </div>

        <!-- 隐藏显示菜单图标 -->
        <a href="#" class="sidebar-open-button"><i class="fa fa-bars"></i></a>
        <a href="#" class="sidebar-open-button-mobile"><i class="fa fa-bars"></i></a>

        <!-- 页面标题 -->
        <h1 class="title">自助售药机后台管理系统</h1>

    </div>

    <!-- 左侧栏 -->
    <div class="sidebar clearfix">

        <!-- 用户信息 -->
        <div class="dropdown link">
            <a href="#" data-toggle="dropdown" class="dropdown-toggle profilebox">
                <img src="../img/profileimg.png" alt="img">
                <div class="user-name"><b id="userInfo"></b><span class="caret"></span></div>
            </a>
            <script>
                // 设置当前用户信息
                $("#userInfo").text(user.realname + "(" + user.username + ")");
            </script>
            <ul class="dropdown-menu dropdown-menu-list dropdown-menu-right">
                <li role="presentation" class="dropdown-header">选项</li>
                <li><a href="login.html"><i class="fa falist fa-power-off"></i> 退出</a></li>
            </ul>
        </div>

        <!-- 菜单 -->
        <ul class="sidebar-panel nav">
            <li class="sidetitle">机器管理</li>
            <li><a href="runStatus.html"><span class="icon color5"><i class="fa fa-home"></i></span>运行状态</a></li>
            <li>
                <a href="#"><span class="icon color7"><i class="fa fa-laptop"></i></span>药机管理<span class="caret"></span></a>
                <ul>
                    <li><a href="machineGroup.html">机器分组</a></li>
                    <li><a href="motorInfo.html">货道设置</a></li>
                    <li><a href="machineInfo.html">机器信息设置</a></li>
                    <li><a href="maintain.html">机器维护</a></li>
                </ul>
            </li>
            <li><a href="wsdChart.html"><span class="icon color6"><i class="fa fa-bar-chart"></i></span>温湿度详情</a></li>
            <li><a href="warningStatus.html"><span class="icon color6"><i class="fa fa-bar-chart"></i></span>警报详情</a></li>
        </ul>
        <ul class="sidebar-panel nav">
            <li class="sidetitle">药品管理</li>
            <li><a href="categoryInfo.html"><span class="icon color5"><i class="fa fa-folder"></i></span>分类管理</a></li>
            <li><a href="drugInfo.html"><span class="icon color6"><i class="fa fa-calendar"></i></span>药品列表</a></li>
            <li style="display:none"><a href="#"><span class="icon color7"><i class="fa fa-sort-amount-asc"></i></span>期效管理<span class="caret"></span></a></li>
            <li><a href="lotNumber.html"><span class="icon color6"><i class="fa fa-file-word-o"></i></span>批号管理</a></li>
            <li><a href="situation.html"><span class="icon color5"><i class="fa fa-folder"></i></span>病情管理</a></li>

        </ul>
        <ul class="sidebar-panel nav">
            <li class="sidetitle">记录管理</li>
            <li><a href="saleRecord.html"><span class="icon color5"><i class="fa fa-calendar-o"></i></span>销售记录</a></li>
            <li style="display:none"> <a href=""><span class="icon color6"><i class="fa fa-calendar"></i></span>操作记录</a>
            <li>
                <a href="#"><span class="icon color7"><i class="fa fa-calendar-o"></i></span>药品记录<span class="caret"></span></a>
                <ul>
                    <li><a href="addDrugInfo.html">上药记录</a></li>
                    <li><a href="subDrugInfo.html">撤药记录</a></li>
                </ul>
            </li>
            <li><a href="" style="display:none"><span class="icon color6"><i class="fa fa-calendar"></i></span>报警记录</a></li>
        </ul>
        <ul class="sidebar-panel nav">
            <li class="sidetitle">用户管理</li>
            <li><a href="userInfo.html"><span class="icon color5"><i class="fa fa-user"></i></span>用户信息</a></li>
        </ul>
        <ul class="sidebar-panel nav" style="display:none">
            <li class="sidetitle">财务管理</li>
            <li><a href="blank1.html"><span class="icon color5"><i class="fa fa-calendar-o"></i></span>销售统计</a></li>
        </ul>
        <ul class="sidebar-panel nav">
            <li class="sidetitle">其他设置</li>
            <li><a href="sysSetting.html"><span class="icon color12"><i class="fa fa-cog"></i></span>系统设置</a></li>
        </ul>
    </div>

    <!-- 主内容 -->
    <div class="content">

        <!-- 当前页面的菜单位置 -->
        <div class="page-header">
            <ol class="breadcrumb" id="breadcrumb">
                <li>其他设置</li>
                <li>系统设置</li>
            </ol>
        </div>

        <!-- 内容 -->
        <div class="container-padding container-widget" id="content">

            <div class="row">
                <!-- 支付参数设置 -->
                <div class="col-md-12 col-lg-6">
                    <div class="panel panel-widget">
                        <div class="panel-title " style="font-size:15px">
                            支付参数
                        </div>
                        <div class="panel-body ">
                            <label for="zfbappid" class="form-label">支付宝appid：</label>
                            <input type="text" class="form-control form-control-radius" id="zfbappid" value="" spellcheck="false">
                            <br>
                            <label for="wxappid" class="form-label">微信appid：</label>
                            <input type="text" class="form-control form-control-radius" id="wxappid" value="" spellcheck="false">
                            <br>
                            <label for="mchid" class="form-label">微信mchid：</label>
                            <input type="text" class="form-control form-control-radius" id="mchid" value="" spellcheck="false">
                            <br>
                            <label for="key" class="form-label">微信key：</label>
                            <input type="text" class="form-control form-control-radius" id="key" value="" spellcheck="false">
                            <br>
                            <div class="text-r">
                                <a class="btn-lg btn-rounded btn-default " onclick="savePay()">保存</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 记录期限参数设置 -->
                <div class="col-md-12 col-lg-6">
                    <div class="panel panel-widget">
                        <div class="panel-title " style="font-size:15px">
                            期限参数
                        </div>
                        <div class="panel-body ">
                            <label for="wsdLog" class="form-label">温湿度记录保存期限(天)：</label>
                            <input type="text" class="form-control form-control-radius" id="wsdLog" value="" spellcheck="false">

                            <label for="warringLog" class="form-label" style="display:none">报警记录保存期限(天)：</label>
                            <input type="text" class="form-control form-control-radius" id="warringLog" value="" spellcheck="false" style="display:none">

                            <label for="opLog" class="form-label" style="display:none">操作记录保存期限(天)：</label>
                            <input type="text" class="form-control form-control-radius" id="opLog" value="" spellcheck="false" style="display:none">
                            <br>
                            <label for="drugLog" class="form-label">药品记录保存期限(天)：</label>
                            <input type="text" class="form-control form-control-radius" id="drugLog" value="" spellcheck="false">
                            <br>
                            <div class="text-r">
                                <a class="btn-lg btn-rounded btn-default" onclick="saveLogTime()">保存</a>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- 灯箱开启时间 -->
                <div class="col-md-12 col-lg-6">
                    <div class="panel panel-widget">
                        <div class="panel-title " style="font-size:15px">
                            开启灯箱
                        </div>
                        <div class="panel-body ">
                            <label for="startTime" class="form-label">开始时间（00:00）：</label>
                            <input type="time" class="form-control " id="startTime" value="" spellcheck="false">
                            <br>
                            <label for="endTime" class="form-label">结束时间时间（23:59）：</label>
                            <input type="time" class="form-control " id="endTime" value="" spellcheck="false">

                            <br>
                            <div class="text-r">
                                <a class="btn-lg btn-rounded btn-default " onclick="alterLight()">保存</a>
                            </div>
                        </div>

                    </div>
                </div>

            </div>

            <div class="row">

                <!-- 售药机待机广告设置 -->
                <div class="col-md-12 col-lg-12">
                    <div class="panel panel-widget">
                        <div class="panel-title " style="font-size:15px">
                            售药机广告设置
                        </div>
                        <div class="panel-body ">

                            <div class="col-lg-12 col-md-12 text-r">
                                <a class="btn-lg btn-rounded btn-success" onclick="commonBind.OpenAdFileDialog();">添加</a>
                            </div>

                            <div class="col-lg-6 col-md-12">
                                <img src="" alt="广告图片" width="100%" style="border:1px solid" id="adImg" />
                            </div>

                            <div class="col-lg-6 col-md-12" id="tableParent">
                                <table id="table" class="table "></table>
                            </div>

                        </div>
                    </div>

                </div>

            </div>


        </div>

    </div>

    <!-- 底部信息 -->
    <div class="row footer" style="display:none">
        <div class="col-md-6 text-left">
            Copyright &copy; 2018.Company name All rights reserved.<a href="#">沈阳华天基曼龙有限公司</a>
        </div>
        <div class="col-md-6 text-right"></div>
    </div>

    <script src="../js/bootstrap/bootstrap.min.js"></script>
    <script src="../js/plugins.js"></script>
    <script src="../js/datatables/datatables.min.js"></script> <!-- Data Tables -->
    <script src="../js/bootstrap-select/bootstrap-select.js"></script> <!-- Bootstrap Select -->
    <script src="../js/bootstrap-toggle/bootstrap-toggle.min.js"></script> <!-- Bootstrap Toggle -->
    <script src="../js/moment/moment.min.js"></script> <!-- Moment.js -->
    <script src="../js/date-range-picker/daterangepicker.js"></script> <!-- Bootstrap Date Range Picker -->
    <script src="../js/sweet-alert/sweet-alert.min.js"></script> <!-- Sweet Alert -->
    <script src="../js/Modern-alert/main.js"></script><!-- Modern Alert -->
    <!-- 错误提示 -->
    <div id="alerttop" class="Modern-alert Modern-alert-icon Modern-alert-click alert6 Modern-alert-top"></div>
    <!-- 成功提示 -->
    <div id="successtop" class="Modern-alert Modern-alert-icon Modern-alert-click alert3 Modern-alert-top"></div>


    <script>
        // 修改灯箱开关事件
        function alterLight() {
            var sTime = $('#startTime').val();
            var eTime = $('#endTime').val();
            if (commonBind.AlterLightTime(sTime, eTime)) {
                $("#successtop").text('信息修改成功');
                $("#alerttop").fadeOut(1);
                $("#successtop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#successtop").fadeOut(350); }, 2000);

            } else {
                $("#alerttop").text('信息修改失败');
                $("#successtop").fadeOut(1);
                $("#alerttop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#alerttop").fadeOut(350); }, 2000);
            }
        }

        var timeout = null;

        $.ajax({
            cache: false,
            type: "POST",
            url: "http://127.0.0.1:8081/constantInfo",
            dataType: "json",
            success: function (data) {

                $("#zfbappid").val(data[0].zfb_appid);
                $("#wxappid").val(data[0].wx_appid);
                $("#mchid").val(data[0].wx_mchid);
                $("#key").val(data[0].wx_key);


                $("#startTime").val(data[0].light_start_time);
                $("#endTime").val(data[0].light_end_time);
                $("#wsdLog").val(data[0].temperature_humidity_times);
                $("#drugLog").val(data[0].drug_log_time);

            },
            error: function () {
            }
        });
        var timeout = null;

        // 保存支付参数
        function savePay() {
            if (commonBind.SavePay($("#wxappid").val().trim(), $("#mchid").val(), $("#key").val(), $("#zfbappid").val())) {
                $("#successtop").text('信息修改成功');
                $("#alerttop").fadeOut(1);
                $("#successtop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#successtop").fadeOut(350); }, 2000);

            } else {
                $("#alerttop").text('信息修改失败');
                $("#successtop").fadeOut(1);
                $("#alerttop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#alerttop").fadeOut(350); }, 2000);
            }
        }

        function addAd(result, url) {
            if (result) {
                $("#successtop").text('添加成功');
                $("#alerttop").fadeOut(1);
                $("#successtop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                tb.draw(true);
                timeout = setTimeout(function () { $("#successtop").fadeOut(350); }, 2000);

            } else {
                $("#alerttop").text('添加失败');
                $("#successtop").fadeOut(1);
                $("#alerttop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#alerttop").fadeOut(350); }, 2000);
            }
            $('#adImg').attr('src', url);
        }
        // 更改记录期限
        function saveLogTime() {
            //$("#startTime").val(data[0].light_start_time);
            //$("#endTime").val(data[0].light_end_time);

            if (commonBind.SaveLogTime($("#wsdLog").val().trim(), $("#drugLog").val())) {
                $("#successtop").text('信息修改成功');
                $("#alerttop").fadeOut(1);
                $("#successtop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#successtop").fadeOut(350); }, 2000);

            } else {
                $("#alerttop").text('信息修改失败');
                $("#successtop").fadeOut(1);
                $("#alerttop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#alerttop").fadeOut(350); }, 2000);
            }
        }


        var tb = null;
        // 查询
        function mySearch() {

            $("#tableParent").empty();
            $("#tableParent").append("<table id='table' class='table'><thead><tr><th>图片地址</th><th>操作</th></tr></thead></table>");

            return $('#table').DataTable({
                //"processing": true, // 显示正在加载
                "serverSide": true, // 服务器模式
                "ajax": {
                    "cache": false,
                    "type": "POST",
                    "dataType": "JSON",
                    "url": "http://127.0.0.1:8081/advertising"
                },
                "pagingType": "full_numbers", // 显示全部分页按钮
                "iDisplayLength": 50, // 每页显示条数
                "bFilter": false, // 右上角过滤搜索
                "bInfo": false,   // 左下角信息
                "bLengthChange": false, // 左上角条数选择
                "ordering": false, // 禁止排序
                "createdRow": function (row, datat, index) {
                    $(row).attr('data-id', datat.id);

                    var deleteButton = "<a  class='btn btn-danger' onclick='deleteDrug(this)'><i class='fa fa-trash-o'></i>删除</a>";
                    $('td', row).eq(1).html(deleteButton);


                },
                "language": {
                    "paginate": {
                        "first": "首页",
                        "previous": "上一页",
                        "next": "下一页",
                        "last": "尾页"
                    },
                    "zeroRecords": "无数据"
                },
                "columns":
                    [
                        { "data": "url", "width": "auto" },
                        { "data": "id", "width": "auto" }
                    ],
                "bAutoWidth": false
            });
        }
        // 初始化表格
        tb = mySearch();


        // 删除分组
        function deleteDrug(obj) {
            var id = $(obj).parents('tr').attr('data-id');
            if (commonBind.DeleteAd(id)) {
                $("#successtop").text('删除成功');
                $("#alerttop").fadeOut(1);
                $("#successtop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#successtop").fadeOut(350); }, 2000);
                tb.draw(true);
                $("#alterClose").click();
            } else {
                $("#alerttop").text('删除失败');
                $("#successtop").fadeOut(1);
                $("#alerttop").fadeIn(350);
                if (timeout != null) {
                    clearTimeout(timeout);
                }
                timeout = setTimeout(function () { $("#alerttop").fadeOut(350); }, 2000);
            }
        }


        $('#table tbody').on('click', 'tr', function () {
            $('#adImg').attr('src', $('td', this).eq(0).text());
        });


    </script>

</body>
</html>